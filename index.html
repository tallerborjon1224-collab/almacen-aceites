<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Almac√©n de Aceites</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ff8c1a">
    <link rel="icon" type="image/png" href="icono.png">


<style>

/* ================= VARIABLES ================= */

:root{
    --naranja:#ff8c1a;
    --negro:#000;
    --gris:#1a1a1a;
    --gris2:#262626;
    --blanco:#fff;
    --verde:#4CAF50;
    --rojo:#c62828;
}

/* ================= BASE ================= */

body{
    margin:0;
    background:var(--negro);
    color:var(--blanco);
    font-family:Arial, sans-serif;
    padding:20px;
    padding-bottom:120px;
}

h1{
    text-align:center;
    color:var(--naranja);
    margin-bottom:25px;
}

.seccion{ display:none; }
.seccion.activa{ display:block; }

/* ================= BOTONES GENERALES ================= */

button{
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-size:15px;
    padding:8px 14px;
    transition:0.15s ease;
}

button:active{
    transform:scale(0.95);
}

/* ================= MENU INFERIOR ================= */

.menu{
    position:fixed;
    bottom:0;
    left:0;
    width:100%;
    background:#111;
    border-top:2px solid var(--naranja);
    display:flex;
    justify-content:center;
    gap:20px;
    padding:10px 0;
    z-index:9999;
}

.menu button{
    background:var(--gris2);
    color:white;
    border:1px solid var(--naranja);
    border-radius:12px;
    font-size:14px;
}

.menu button.activo{
    background:var(--naranja);
    color:black;
}

/* ================= INVENTARIO LISTA ================= */

.inventario-app{
    max-width:900px;
    margin:auto;
}

.card-item{
    background:var(--gris);
    border:2px solid var(--naranja);
    border-radius:18px;
    padding:20px;
    margin:18px 0;
    cursor:pointer;
    transition:0.2s;
}

.card-item:hover{
    transform:scale(1.02);
    box-shadow:0 0 12px rgba(255,140,26,0.4);
}

.card-item h3{
    font-size:20px;
    margin-bottom:8px;
    color:white;
}

.card-item p{
    margin:4px 0;
    color:#ccc;
}

.stock-bajo{
    color:red;
    font-weight:bold;
}

/* ================= DETALLE PRODUCTO ================= */

.detalle-box{
    background:var(--gris);
    border:2px solid var(--naranja);
    border-radius:18px;
    padding:25px;
    margin-top:20px;
}

.detalle-box h2{
    font-size:28px;
    margin-bottom:15px;
    color:white;
}

.detalle-box p{
    font-size:17px;
    margin:8px 0;
    color:#ccc;
}

.detalle-box strong{
    color:var(--naranja);
}

.precio-destacado{
    font-size:22px;
    color:var(--verde);
    font-weight:bold;
    margin-top:10px;
}

.stock-destacado{
    font-size:26px;
    color:var(--naranja);
    font-weight:bold;
    margin:18px 0;
}

/* ================= MOVIMIENTO STOCK ================= */

.movimiento-box{
    margin-top:20px;
    background:var(--gris2);
    padding:20px;
    border-radius:14px;
}

.movimiento-box h4{
    margin-bottom:10px;
    color:var(--naranja);
}

.movimiento-box input,
.movimiento-box textarea{
    width:100%;
    padding:10px;
    border-radius:8px;
    border:none;
    background:#000;
    color:white;
    font-size:15px;
}

.movimiento-box textarea{
    margin-top:10px;
    resize:none;
}

.movimiento-box button{
    margin-top:10px;
}

.btn-sumar{
    background:var(--verde);
    color:white;
}

.btn-restar{
    background:var(--rojo);
    color:white;
}

/* ================= HISTORIAL ================= */

.historial-item{
    background:#111;
    padding:12px;
    border-radius:10px;
    margin:8px 0;
    font-size:14px;
    color:#bbb;
    border-left:4px solid var(--naranja);
}

/* ================= VENTAS ================= */

.ventas-card{
    max-width:900px;
    margin:auto;
    padding:30px;
}

.tabla-ventas{
    width:100%;
    border-collapse:collapse;
    font-size:18px;
}

.tabla-ventas th{
    padding:15px;
    border-bottom:2px solid var(--naranja);
}

.tabla-ventas td{
    padding:15px;
    text-align:center;
}

.tabla-ventas select,
.tabla-ventas input{
    width:100%;
    padding:8px;
    font-size:16px;
    text-align:center;
    background:#000;
    color:white;
    border:none;
}

.botones-ventas{
    display:flex;
    justify-content:center;
    gap:15px;
    margin-top:20px;
    flex-wrap:wrap;
}

.ganancia{
    text-align:center;
    font-size:24px;
    margin-top:20px;
}

/* ================= REGISTRO ================= */

.registro-nuevo{
    max-width:900px;
    margin:auto;
    background:var(--gris);
    border:2px solid var(--naranja);
    border-radius:20px;
    padding:25px;
}

.form-carro{
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:20px;
}

.campo{
    display:flex;
    flex-direction:column;
}

.campo label{
    margin-bottom:5px;
    font-weight:bold;
    color:var(--naranja);
}

.campo input{
    padding:10px;
    border-radius:8px;
    border:none;
    background:#000;
    color:white;
    font-size:15px;
}

.btn-guardar{
    margin-top:20px;
    width:100%;
    padding:12px;
    font-size:16px;
}

#listaCarros{
    margin-top:20px;
}

.tarjeta-carro{
    background:var(--gris2);
    padding:15px;
    border-radius:12px;
    margin-bottom:15px;
    border-left:5px solid var(--naranja);
}

/* ================= RESPONSIVE ================= */

@media(max-width:768px){

    body{
        padding:12px;
        padding-bottom:130px;
    }

    h1{
        font-size:22px;
    }

    .form-carro{
        grid-template-columns:1fr;
    }

    .ventas-card{
        padding:15px;
    }

    .tabla-ventas{
        font-size:14px;
    }

    .ganancia{
        font-size:20px;
    }
}
.presupuesto-box{
    max-width:500px;
    margin:40px auto;
    display:flex;
    flex-direction:column;
    gap:15px;
}

.presupuesto-box input{
    padding:12px;
    border-radius:8px;
    border:none;
    background:#111;
    color:white;
}
</style>
</head>

<body>

<!-- ================= MENU ================= -->
<div class="menu">
    <button id="btnRegistro" onclick="mostrar('registro')">üöó Registro</button>
    <button id="btnAlmacen" class="activo" onclick="mostrar('almacen')">üõ¢ Inventario</button>
    <button id="btnVentas" onclick="mostrar('ventas')">üí∞ Ventas</button>
    <button id="btnPresupuesto" onclick="mostrar('presupuesto')">üìÑ Presupuesto</button>
</div>
 

<!-- ================= INVENTARIO ================= -->
<section id="almacen" class="seccion activa">

<h1>Inventario del Taller</h1>

<div class="inventario-app">

    <!-- LISTA -->
    <div id="vistaLista">

        <div class="card-item" onclick="abrirDetalle(0)">
            <h3>Aceite 5W-30 Sint√©tico</h3>
        </div>

        <div class="card-item" onclick="abrirDetalle(1)">
            <h3>Filtro de Aceite Toyota</h3>
        </div>

        <div class="card-item" onclick="abrirDetalle(2)">
            <h3>Anticongelante Rojo</h3>
        </div>

    </div>

    <!-- DETALLE -->
    <div id="vistaDetalle" style="display:none;">

        <button onclick="volverLista()">‚¨Ö Volver</button>

        <div class="detalle-box">

           <h2 id="detalleNombre" style="text-align:center;"></h2>

<div class="stock-destacado">
    Aceites disponibles: <span id="detalleStock"></span>
</div>

            <div class="movimiento-box">

                <h4>Movimiento de Inventario</h4>

                <input type="number" id="cantidadMovimiento" placeholder="Cantidad">

                <textarea id="notaMovimiento" placeholder="Nota opcional"></textarea>

                <button class="btn-sumar" onclick="sumarStock()">‚ûï Agregar</button>
                <button class="btn-restar" onclick="restarStock()">‚ûñ Restar</button>

            </div>

            <div id="historialMovimientos"></div>

        </div>

    </div>

</div>

</section>


<!-- ================= VENTAS ================= -->
<section id="ventas" class="seccion">

<h1>Venta de Aceite</h1>

<div class="ventas-card">

<table class="tabla-ventas">
<thead>
<tr>
<th>Producto</th>
<th>Cantidad</th>
<th>Precio</th>
<th>Total</th>
</tr>
</thead>

<tbody>
<tr>
<td>
<select id="productoVenta"></select>
</td>

<td>
<input type="number" id="cantidadVenta" min="1" value="1">
</td>

<td>$<span id="precioUnitario">0</span></td>
<td>$<span id="totalVenta">0</span></td>
</tr>
</tbody>
</table>

<div class="botones-ventas">
<button onclick="calcularTotal()" class="btn-sumar">Calcular</button>
<button onclick="vender()" class="btn-sumar">Confirmar</button>
<button onclick="cancelarVenta()" class="btn-restar">Cancelar</button>
</div>

<hr>

<h2 style="text-align:center; color:orange;">Historial de Ventas</h2>
<div id="listaHistorial"></div>

<h2 class="ganancia">
Ganancia Hoy: $<span id="gananciaHoy">0</span>
</h2>

<div class="botones-ventas">
<button onclick="borrarVentasHoy()" class="btn-restar">Borrar Ventas de Hoy</button>
<button onclick="reiniciarTodo()" class="btn-restar">Reiniciar Todo</button>
</div>

</div>

</section>


<!-- ================= REGISTRO ================= -->
<section id="registro" class="seccion">

<h1>Registro de Carros</h1>

<div class="registro-nuevo">

<div class="form-carro">

<div class="campo">
<label>Placas</label>
<input type="text" id="placas">
</div>

<div class="campo">
<label>Marca</label>
<input type="text" id="marca">
</div>

<div class="campo">
<label>Modelo</label>
<input type="text" id="modelo">
</div>

<div class="campo">
<label>Servicio Realizado</label>
<input type="text" id="servicio">
</div>

<div class="campo">
<label>Fecha</label>
<input type="date" id="fecha">
</div>

</div>
</section>


<!-- ================= PRESUPUESTO ================= -->
<section id="presupuesto" class="seccion">

<h1>Generar Presupuesto</h1>

<div class="presupuesto-box">

<input type="text" id="nombreCliente" placeholder="Nombre del cliente">
<input type="text" id="marcaVehiculo" placeholder="Marca">
<input type="text" id="modeloVehiculo" placeholder="Modelo">
<input type="number" id="anioVehiculo" placeholder="A√±o">

<h3>Trabajos</h3>

<div id="listaTrabajos"></div>

<button onclick="agregarTrabajo()" class="btn-sumar">‚ûï Agregar Trabajo</button>

<h3>Resumen</h3>
<p>Subtotal: $<span id="subtotal">0</span></p>
<p>IVA (0.08%): $<span id="iva">0</span></p>
<p>Total: $<span id="total">0</span></p>

<button class="btn-sumar" onclick="generarPDF()">
Generar PDF
</button>

</div>
</section>
<script>

// ================= MENU =================
function mostrar(id){

    document.querySelectorAll('.seccion').forEach(s=>{
        s.classList.remove('activa');
    });

    document.getElementById(id).classList.add('activa');

    document.querySelectorAll('.menu button').forEach(b=>{
        b.classList.remove('activo');
    });

    const btn = document.getElementById(
        'btn' + id.charAt(0).toUpperCase() + id.slice(1)
    );

    if(btn) btn.classList.add('activo');
}



// ================= INVENTARIO MODERNO =================

// Productos predeterminados
let inventario = JSON.parse(localStorage.getItem("inventarioNuevo")) || [

    {
        nombre:"Aceite 5W-30 Sint√©tico",
        precio:850,
        stock:10,
        fecha:"01/02/2026",
        historial:[]
    },

    {
        nombre:"Filtro de Aceite Toyota",
        precio:250,
        stock:5,
        fecha:"01/02/2026",
        historial:[]
    },

    {
        nombre:"Anticongelante Rojo",
        precio:300,
        stock:8,
        fecha:"01/02/2026",
        historial:[]
    }

];

let productoActual = null;

function guardarInventario(){
    localStorage.setItem("inventarioNuevo", JSON.stringify(inventario));
}



function abrirDetalle(index){

    productoActual = index;

    document.getElementById("vistaLista").style.display="none";
    document.getElementById("vistaDetalle").style.display="block";

    const item = inventario[index];

    document.getElementById("detalleNombre").innerText = item.nombre;
    document.getElementById("detalleStock").innerText = item.stock;

    renderHistorial();
    if(item.stock <= 3){
    document.getElementById("detalleStock").style.color="red";
}else{
    document.getElementById("detalleStock").style.color="white";
}
}



// ===== VOLVER =====
function volverLista(){

    document.getElementById("vistaLista").style.display="block";
    document.getElementById("vistaDetalle").style.display="none";

}



// ===== SUMAR STOCK =====
function sumarStock(){

    const cantidad = Number(document.getElementById("cantidadMovimiento").value);
    const nota = document.getElementById("notaMovimiento").value;

    if(isNaN(cantidad) || cantidad <= 0) return;

    const item = inventario[productoActual];

    item.stock += cantidad;

    item.historial.push({
        tipo:"Entrada",
        cantidad:cantidad,
        nota:nota || "",
        fecha:new Date().toLocaleString()
    });

    actualizarVista();
}



// ===== RESTAR STOCK =====
function restarStock(){

    const cantidad = Number(document.getElementById("cantidadMovimiento").value);
    const nota = document.getElementById("notaMovimiento").value;

    if(isNaN(cantidad) || cantidad <= 0) return;

    const item = inventario[productoActual];

    if(item.stock < cantidad){
        alert("No hay suficiente stock");
        return;
    }

    item.stock -= cantidad;

    item.historial.push({
        tipo:"Salida",
        cantidad:cantidad,
        nota:nota || "",
        fecha:new Date().toLocaleString()
    });

    actualizarVista();
}



// ===== ACTUALIZAR DETALLE =====
function actualizarVista(){

    guardarInventario();

    document.getElementById("detalleStock").innerText =
        inventario[productoActual].stock;

    document.getElementById("cantidadMovimiento").value="";
    document.getElementById("notaMovimiento").value="";

    renderHistorial();
    if(inventario[productoActual].stock <= 3){
    document.getElementById("detalleStock").style.color="red";
}else{
    document.getElementById("detalleStock").style.color="white";
}
}



function renderHistorial(){

    const contenedor = document.getElementById("historialMovimientos");
    contenedor.innerHTML = "";

    const historial = inventario[productoActual].historial;

    if(historial.length === 0){
        contenedor.innerHTML = "<p>Sin movimientos</p>";
        return;
    }

    historial.slice().reverse().forEach((m,i)=>{

        const indexReal = historial.length - 1 - i;

        contenedor.innerHTML += `
            <div class="historial-item">
                <strong>${m.tipo}</strong> - ${m.cantidad}<br>
                ${m.fecha}<br>
                ${m.nota || ""}<br>
                <button onclick="borrarMovimiento(${indexReal})">
                    ‚ùå Borrar
                </button>
            </div>
        `;
    });
}
// ================= VENTAS (BASE SIMPLE) =================

let gananciaHoy = 0;

function calcularTotal(){

    const select = document.getElementById("productoVenta");
    const cantidad = Number(document.getElementById("cantidadVenta").value);

    if(isNaN(cantidad) || cantidad <= 0) return;

    const producto = inventario[select.value];

    document.getElementById("precioUnitario").innerText = producto.precio;
    document.getElementById("totalVenta").innerText =
        producto.precio * cantidad;
}



function vender(){

    const select = document.getElementById("productoVenta");
    const cantidad = Number(document.getElementById("cantidadVenta").value);

    const producto = inventario[select.value];

    if(producto.stock < cantidad){
        alert("No hay suficiente stock");
        return;
    }

    producto.stock -= cantidad;
    gananciaHoy += producto.precio * cantidad;

    document.getElementById("gananciaHoy").innerText = gananciaHoy;

    guardarInventario();
    alert("Venta realizada");
}



// ===== CARGAR SELECT VENTAS =====
function cargarProductosVenta(){

    const select = document.getElementById("productoVenta");
    if(!select) return;

    select.innerHTML="";

    inventario.forEach((item,index)=>{
        select.innerHTML += `
            <option value="${index}">
                ${item.nombre}
            </option>
        `;
    });
}



// ===== INICIAR =====
window.addEventListener("load", ()=>{
    guardarInventario();
    cargarProductosVenta();
});
   function borrarMovimiento(index){

    if(!confirm("¬øEliminar este movimiento?")) return;

    const item = inventario[productoActual];
    const movimiento = item.historial[index];

    // Revertir stock
    if(movimiento.tipo === "Entrada"){
        item.stock -= movimiento.cantidad;
    }else{
        item.stock += movimiento.cantidad;
    }

    item.historial.splice(index,1);

    guardarInventario();
    actualizarVista();
}
    
</script>
<script>

    let trabajos = [];

function agregarTrabajo(){
    const cont = document.getElementById("listaTrabajos");

    const index = trabajos.length;

    cont.innerHTML += `
        <div style="display:flex; gap:10px; margin-bottom:10px;">
            <input type="number" placeholder="Cant." 
                onchange="actualizarTrabajo(${index}, 'cantidad', this.value)">
            <input type="text" placeholder="Descripci√≥n"
                onchange="actualizarTrabajo(${index}, 'descripcion', this.value)">
            <input type="number" placeholder="Importe"
                onchange="actualizarTrabajo(${index}, 'importe', this.value)">
        </div>
    `;

    trabajos.push({
        cantidad:0,
        descripcion:"",
        importe:0
    });
}

function actualizarTrabajo(index, campo, valor){
    trabajos[index][campo] = valor;
    calcularTotales();
}

function calcularTotales(){
    let subtotal = 0;

    trabajos.forEach(t=>{
        subtotal += Number(t.importe || 0);
    });

    const iva = subtotal * 0.16;
    const total = subtotal + iva;

    document.getElementById("subtotal").innerText = subtotal.toFixed(2);
    document.getElementById("iva").innerText = iva.toFixed(2);
    document.getElementById("total").innerText = total.toFixed(2);
}

async function generarPDF() {

    const { PDFDocument } = PDFLib;

    const existingPdfBytes = await fetch('Plantilla_Borjon.pdf').then(res => res.arrayBuffer());
    const pdfDoc = await PDFDocument.load(existingPdfBytes);
    const page = pdfDoc.getPages()[0];

    const nombre = document.getElementById("nombreCliente").value;
    const marca = document.getElementById("marcaVehiculo").value;
    const modelo = document.getElementById("modeloVehiculo").value;
    const anioVehiculo = document.getElementById("anioVehiculo").value;

    const vehiculo = marca + " " + modelo + " " + anioVehiculo;

    const fecha = new Date();
    const dia = fecha.getDate().toString();
    const mes = (fecha.getMonth()+1).toString();
    const a√±o = fecha.getFullYear().toString();
//ENCABEZADO//
  const fontSizeFecha = 12;

function drawCentered(text, centerX, yPos){
    const textWidth = text.length * 6;
    page.drawText(text, { 
        x: centerX - (textWidth / 2), 
        y: yPos, 
        size: fontSizeFecha 
    });
}

// Ajusta estos centros si hace falta mover 2-3 px
drawCentered(dia, 50, 610);
drawCentered(mes, 150, 610);
drawCentered(a√±o, 250, 610);

   page.drawText(nombre, { x: 360, y: 635, size: 12 });
   page.drawText(vehiculo, { x: 360, y: 595, size: 12 });

    // ===== TABLA =====
    let y = 540;

 const fontSize = 10;

trabajos.forEach(t => {

    page.drawText(String(t.cantidad), { x: 60, y: y, size: fontSize });

    const importeTexto = "$" + Number(t.importe).toFixed(2);

    const textWidth = importeTexto.length * 5.5;
    const xPosition = 550 - textWidth; // borde derecho tabla

    page.drawText(importeTexto, { x: xPosition, y: y, size: fontSize });

    y -= 20;
});

    let subtotal = 0;

trabajos.forEach(t=>{
    subtotal += Number(t.importe || 0);
});

const iva = subtotal * 0.08;
const total = subtotal + iva;

    // ===== TOTALES =====
  function drawRight(text, yPos){
    const textWidth = text.length * 6;
    page.drawText(text, { x: 550 - textWidth, y: yPos, size: 12 });
}

drawRight("$" + subtotal.toFixed(2), 180);
drawRight("$" + iva.toFixed(2), 160);
drawRight("$" + total.toFixed(2), 140);

    const pdfBytes = await pdfDoc.save();

    const blob = new Blob([pdfBytes], { type: 'application/pdf' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = "Presupuesto_Borjon.pdf";
    link.click();

    alert("Presupuesto generado correctamente ‚úÖ");
}
</script>

</section>
    <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
    
</body>
</html>































