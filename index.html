<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Almac√©n de Aceites</title>

<style>

.seccion{ display:none; }
.seccion.activa{ display:block; }

.menu{
    position:fixed;
    bottom:0;
    left:0;
    width:100%;
    background:#111;
    display:flex;
    justify-content:space-around;
    padding:12px 0;
    border-top:2px solid var(--naranja);
}

.menu button{
    background:none;
    color:white;
    font-size:16px;
}

.menu .activo{ color:var(--naranja); }

.registro{
    max-width:900px;
    margin:30px auto;
}

.registro table{
    width:100%;
    border-collapse:collapse;
}

.registro th,.registro td{
    border:1px solid var(--naranja);
    padding:8px;
    text-align:center;
}

.registro input{
    width:100%;
    background:#000;
    color:#fff;
    border:none;
    text-align:center;
}

:root{
    --naranja:#ff8c1a;
    --negro:#000;
    --gris:#1a1a1a;
    --gris2:#262626;
    --blanco:#fff;
}

body{
    margin:0;
    background:var(--negro);
    color:var(--blanco);
    font-family:Arial, sans-serif;
    padding:20px;
    padding-bottom:100px;

}

h1{
    text-align:center;
    color:var(--naranja);
}

.almacen{
    display: flex;
    justify-content: center;   /* centra horizontal */
    align-items: flex-start;
    gap: 40px;                 /* espacio entre cards */
    max-width: 1200px;
    margin: 30px auto;
    flex-wrap: wrap;           /* baja en pantallas chicas */
}

.card{
    width:420px;
    background:var(--gris);
    border-radius:20px;
    border:2px solid var(--naranja);
    padding:20px;
}

.card h2{
    text-align:center;
    color:var(--naranja);
}

.marca{
    background:var(--gris2);
    border-radius:16px;
    padding:16px;
    margin-bottom:20px;
}

.marca h3{
    text-align:center;
    color:#ffd199;
}

.subtitulo{
    text-align:center;
    font-weight:bold;
    color:var(--naranja);
    margin:12px 0 8px;
    border-bottom:1px solid var(--naranja);
    padding-bottom:4px;
}

.fila{
    display:grid;
    grid-template-columns: 1.6fr 45px 30px 30px;
    gap:6px;
    align-items:center;
    margin-bottom:6px;
}

.numero{
    text-align:center;
    font-size:17px;
    font-weight:bold;
}

button{
    border:none;
    border-radius:6px;
    cursor:pointer;
    font-size:15px;
}

.restar{ background:#444; color:white; }
.sumar{ background:var(--naranja); color:black; }

.menu{
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: #111;
    border-top: 2px solid var(--naranja);
    display: flex;
    justify-content: center;
    gap: 20px;
    padding: 10px 0;
    z-index: 9999;
}

.menu button{
    background: var(--gris2);
    color: white;
    border: 1px solid var(--naranja);
    padding: 10px 18px;
    border-radius: 12px;
    cursor: pointer;
    font-size: 14px;
}

.menu button.activo{
    background: var(--naranja);
    color: black;
}

#btnEstadoGuardado {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 10px 15px;
    border-radius: 10px;
    font-weight: bold;
    font-size: 13px;
    display: flex;
    align-items: center;
    gap: 8px;
    z-index: 10000;
}
.estado-guardado { background: #28a745; color: white; }
.estado-pendiente { background: #ff8c1a; color: black; }
.estado-guardando { background: #007bff; color: white; }


</style>
</head>

<body>

    <div id="btnEstadoGuardado" class="estado-guardado">
    <span id="iconoEstado">‚úÖ</span>
    <span id="textoEstado">Guardado</span>
</div>


<section id="registro" class="seccion">
<h1>Registro de Carros</h1>

<div class="registro">
<table>
<thead>
<tr>
<th>Placas</th>
<th>Marca</th>
<th>Modelo</th>
<th>Servicio</th>
<th>Fecha</th>
</tr>
</thead>
<tbody id="tablaCarros">
<tr>
<td><input></td>
<td><input></td>
<td><input></td>
<td><input></td>
<td><input type="date"></td>
</tr>
</tbody>
</table>

<br>
<button onclick="agregarFila()" class="sumar">‚ûï Agregar carro</button>
</div>
</section>

<section id="almacen" class="seccion activa">

<h1>Almac√©n de Aceites</h1>

<div class="almacen">

<!-- ================= 5W-30 ================= -->
<div class="card">
<h2>Aceite 5W-30</h2>

<!-- VALVOLINE -->
<div class="marca">
<h3>VALVOLINE</h3>
<div class="subtitulo">GALONES</div>
<div class="fila"><span>Sint√©tico</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
<div class="fila"><span>Semisint√©tico</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
<div class="fila"><span>Multigrado</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>

<div class="subtitulo">CUARTOS</div>
<div class="fila"><span>Sint√©tico</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
<div class="fila"><span>Semisint√©tico</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
<div class="fila"><span>Multigrado</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
</div>

<!-- MOBIL -->
<div class="marca">
<h3>MOBIL SUPER</h3>
<div class="subtitulo">GALONES</div>
<div class="fila"><span>Sint√©tico</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
<div class="fila"><span>Semisint√©tico</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
<div class="fila"><span>Multigrado</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>

<div class="subtitulo">CUARTOS</div>
<div class="fila"><span>Sint√©tico</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
<div class="fila"><span>Semisint√©tico</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
<div class="fila"><span>Multigrado</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
</div>

<!-- SUPREME -->
<div class="marca">
<h3>SUPREME</h3>
<div class="subtitulo">GALONES</div>
<div class="fila"><span>Sint√©tico</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
<div class="fila"><span>Semisint√©tico</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
<div class="fila"><span>Multigrado</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>

<div class="subtitulo">CUARTOS</div>
<div class="fila"><span>Sint√©tico</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
<div class="fila"><span>Semisint√©tico</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
<div class="fila"><span>Multigrado</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
</div>

<!-- ACDELCO -->
<div class="marca">
<h3>ACDELCO</h3>
<div class="subtitulo">GALONES</div>
<div class="fila"><span>Sint√©tico</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
<div class="fila"><span>Semisint√©tico</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
<div class="fila"><span>Multigrado</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>

<div class="subtitulo">CUARTOS</div>
<div class="fila"><span>Sint√©tico</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
<div class="fila"><span>Semisint√©tico</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
<div class="fila"><span>Multigrado</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
</div>
</div>


<!-- ================= 10W-30 ================= -->
<div class="card">
<h2>Aceite 10W-30</h2>

<div class="marca">
<h3>VALVOLINE</h3>
<div class="subtitulo">GALONES</div>
<div class="fila"><span>Sint√©tico</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
<div class="fila"><span>Semisint√©tico</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
<div class="fila"><span>Multigrado</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>

<div class="subtitulo">CUARTOS</div>
<div class="fila"><span>Sint√©tico</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
<div class="fila"><span>Semisint√©tico</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
<div class="fila"><span>Multigrado</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
</div>

<div class="marca">
<h3>SHELL</h3>
<div class="subtitulo">GALONES</div>
<div class="fila"><span>Sint√©tico</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
<div class="fila"><span>Semisint√©tico</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
<div class="fila"><span>Multigrado</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>

<div class="subtitulo">CUARTOS</div>
<div class="fila"><span>Sint√©tico</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
<div class="fila"><span>Semisint√©tico</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
<div class="fila"><span>Multigrado</span><div class="numero" data-count>0</div><button class="restar">‚ûñ</button><button class="sumar">‚ûï</button></div>
</div>
</div>
</div>
</section> 


<script>
function mostrar(id){
    document.querySelectorAll('.seccion').forEach(s=>{
        s.classList.remove('activa');
    });
    document.getElementById(id).classList.add('activa');

    document.querySelectorAll('.menu button').forEach(b=>{
        b.classList.remove('activo');
    });
    document.getElementById(
        'btn' + id.charAt(0).toUpperCase() + id.slice(1)
    ).classList.add('activo');
}

function agregarFila(){
    const tr = document.createElement("tr");
    tr.innerHTML = `
        <td><input></td>
        <td><input></td>
        <td><input></td>
        <td><input></td>
        <td><input type="date"></td>
    `;
    document.getElementById("tablaCarros").appendChild(tr);
}
</script>

<div class="menu">
<button id="btnAlmacen" class="activo" onclick="mostrar('almacen')">üõ¢ Almac√©n</button>
<button id="btnRegistro" onclick="mostrar('registro')">üöó Registro</button>
</div>

<script>
const URL = "http://192.168.1.84:3000";

let temporizador = null;
let avisoMostrado = false;

function obtenerAlmacen() {
  return [...document.querySelectorAll(".fila")].map((fila, i) => ({
    id: i,
    cantidad: Number(fila.querySelector("[data-count]").textContent)
  }));
}

function actualizarBotonEstado(estado) {
    const btn = document.getElementById("btnEstadoGuardado");
    const icono = document.getElementById("iconoEstado");
    const texto = document.getElementById("textoEstado");

    if (!btn || !icono || !texto) return; // Seguridad por si no encuentra los IDs

    btn.className = ""; // Limpia colores anteriores

    if (estado === "guardado") {
        btn.classList.add("estado-guardado");
        icono.textContent = "‚úÖ";
        texto.textContent = "Guardado";
    } else if (estado === "pendiente") {
        btn.classList.add("estado-pendiente");
        icono.textContent = "‚è≥";
        texto.textContent = "Cambios pendientes...";
    } else if (estado === "guardando") {
        btn.classList.add("estado-guardando");
        icono.textContent = "üîÑ";
        texto.textContent = "Guardando...";
    }
}

async function guardarAutomatico() {
    actualizarBotonEstado("guardado");
  await fetch(URL + "/guardar", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ almacen: obtenerAlmacen() })
  });

  if (!avisoMostrado) {
    mostrarAviso();
    avisoMostrado = true;
  }
}

function mostrarAviso(){
  let aviso = document.getElementById("aviso");
  if(!aviso){
    aviso = document.createElement("div");
    aviso.id = "aviso";
    aviso.textContent = "‚úÖ Cambios guardados";
    aviso.style.cssText = `
      position:fixed;
      bottom:90px;
      left:50%;
      transform:translateX(-50%);
      background:#111;
      color:#ff8c1a;
      padding:10px 18px;
      border-radius:12px;
      border:1px solid #ff8c1a;
      font-size:14px;
    `;
    document.body.appendChild(aviso);
    setTimeout(()=> aviso.remove(), 3000);
  }
}

document.addEventListener("click", e => {
  if (e.target.classList.contains("sumar") || e.target.classList.contains("restar")) {

    const fila = e.target.closest(".fila");
    const num = fila.querySelector("[data-count]");
    let v = Number(num.textContent);
    v += e.target.classList.contains("sumar") ? 1 : -1;
    num.textContent = Math.max(0, v);

    actualizarBotonEstado("pendiente");
     avisoMostrado = false;

    clearTimeout(temporizador);
    temporizador = setTimeout(() => {
      guardarAutomatico();
    }, 1500); // ‚¨ÖÔ∏è espera 1.5 segundos sin tocar nada
  }
});

</script>

<script>
async function cargarAlIniciar() {
  const res = await fetch("http://localhost:3000");
  const data = await res.json();

  if (!data.almacen) return;

  const numeros = document.querySelectorAll("[data-count]");

  data.almacen.forEach((item, i) => {
    if (numeros[i]) {
      numeros[i].textContent = item.cantidad;
    }
  });
}

// cuando abre la p√°gina
window.addEventListener("load", cargarAlIniciar);
</script>

</body>
</html>
